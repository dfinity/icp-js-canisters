name: Integration Tests

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'packages/canisters/src/assets/**'
      - 'tests/integration/**'
  pull_request:
    paths:
      - 'packages/canisters/src/assets/**'
      - 'tests/integration/**'

jobs:
  test-assets-integration:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: dfinity/setup-dfx@main
      - name: Prepare
        uses: ./.github/actions/prepare
      - name: Build
        run: npm run build
      - name: Test integration
        run: npm run test:integration

  may-merge:
    needs: ["test-assets-integration"]
    runs-on: ubuntu-24.04
    steps:
      - name: Cleared for merging
        run: echo OK